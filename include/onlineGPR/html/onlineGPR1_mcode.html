<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">gram_matrix_update</span>,<span class="var type1" id="S3T2U4">y_star</span>,<span class="var type1" id="S4T3U5">cov_star</span>,<span class="var type1" id="S5T4U6">X_update</span>,<span class="var type1" id="S6T5U7">Y_update</span>,<span class="var type1" id="S7T1U8">K_update</span> ] = onlineGPR( <span class="var type1" id="S8T6U11">x</span>,<span class="var type1" id="S9T2U12">y</span>,<span class="var type1" id="S10T6U13">x_star</span>,<span class="var type1" id="S11T7U14">gram_matrix</span>,<span class="var type1" id="S12T8U15">X</span>,<span class="var type1" id="S13T9U16">Y</span>,<span class="var type1" id="S14T7U17">K</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%ONLINEGPR Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% The max size of gram matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo " id="T3:U14"><span class="var type1" id="S15T3U20">MAX_SIZE</span> = <span class="mxinfo " id="T3:U16">100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">    <span class="comment">% Kernel function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo " id="T3:U17"><span class="var type1" id="S16T3U24">L</span> = <span class="mxinfo " id="T3:U19">0.6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T3:U20"><span class="var type1" id="S17T3U28">F</span> = <span class="mxinfo " id="T3:U22">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T10:U23"><span class="var type1" id="S18T10U32">Kfn</span> = <span class="mxinfo " id="T10:U25">@(x,z) <span class="var type0" id="S17T0U38">F</span>^2*exp(-0.5*sq_dist(x,z)/(<span class="var type0" id="S16T0U52">L</span>^2))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T3:U26"><span class="var type1" id="S21T3U56">keps</span> = <span class="mxinfo " id="T3:U28">0.001</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo " id="T3:U29"><span class="var type1" id="S22T3U60">gram_size</span> = <span class="mxinfo " id="T3:U31">length(<span class="var type1" id="S11T7U63">gram_matrix</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">%     % If it is the first time we compute gram marix and return</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="comment">%     if(gram_size == 0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">%         X_update = x;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="comment">%         Y_update = y;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="comment">%         K_update = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="comment">%         gram_matrix_update = inv(K_update+keps*eye(length(K_update)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="comment">% When the size of gram matrix reached a certain number,we use</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    <span class="comment">% Sherman-Morrison formula to update the matrix which means we choose</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    <span class="comment">% one row and column to be replaced by new data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    <span class="keyword">if</span>(<span class="mxinfo " id="T13:U33"><span class="var type1" id="S22T3U68">gram_size</span> == <span class="var type1" id="S15T3U69">MAX_SIZE</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">        <span class="comment">% choose one row and column which has the highest covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">        [<span class="mxinfo " id="T3:U36">~</span>,<span class="var type1" id="S24T3U74">index</span>] = max(<span class="mxinfo " id="T14:U38">mean(<span class="var type1" id="S14T7U79">K</span>,1)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">        <span class="comment">% K(:,index);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">        <span class="mxinfo " id="T6:U40"><span class="mxinfo " id="T6:U41"><span class="var type1" id="S12T8U84">X</span>(<span class="mxinfo " id="T15:U43">:</span>,<span class="var type1" id="S24T3U86">index</span>)</span> = <span class="var type1" id="S8T6U87">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">        <span class="mxinfo " id="T4:U46"><span class="var type1" id="S5T4U90">X_update</span> = <span class="var type1" id="S12T8U91">X</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">        <span class="mxinfo " id="T2:U49"><span class="mxinfo " id="T2:U50"><span class="var type1" id="S13T9U95">Y</span>(<span class="var type1" id="S24T3U96">index</span>,<span class="mxinfo " id="T15:U53">:</span>)</span> = <span class="var type1" id="S9T2U98">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">        <span class="mxinfo " id="T5:U55"><span class="var type1" id="S6T5U101">Y_update</span> = <span class="var type1" id="S13T9U102">Y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">        <span class="mxinfo " id="T16:U58"><span class="var type1" id="S27T16U105">Ks</span> = <span class="mxinfo " id="T17:U60"><span class="mxinfo " id="T10:U61"><span class="fcn" id="F211N7:B10">Kfn</span></span>(<span class="var type1" id="S5T4U108">X_update</span>,<span class="var type1" id="S8T6U109">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">        <span class="mxinfo " id="T16:U64"><span class="var type1" id="S28T16U112">Ks_old</span> = <span class="mxinfo " id="T16:U66"><span class="var type1" id="S14T7U114">K</span>(<span class="mxinfo " id="T18:U68">:</span>,<span class="var type1" id="S24T3U116">index</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="comment">%         K_old = K;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">        <span class="mxinfo " id="T16:U70"><span class="mxinfo " id="T16:U71"><span class="var type1" id="S14T7U120">K</span>(<span class="mxinfo " id="T18:U73">:</span>,<span class="var type1" id="S24T3U122">index</span>)</span> = <span class="var type1" id="S27T16U123">Ks</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">        <span class="mxinfo " id="T14:U76"><span class="mxinfo " id="T14:U77"><span class="var type1" id="S14T7U127">K</span>(<span class="var type1" id="S24T3U128">index</span>,<span class="mxinfo " id="T18:U80">:</span>)</span> = <span class="mxinfo " id="T14:U81"><span class="var type1" id="S27T16U131">Ks</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">        <span class="mxinfo " id="T1:U83"><span class="var type1" id="S7T1U134">K_update</span> = <span class="var type1" id="S14T7U135">K</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">        <span class="mxinfo " id="T19:U86"><span class="var type1" id="S29T19U138">u</span> = <span class="mxinfo " id="T19:U88">zeros(<span class="var type1" id="S15T3U141">MAX_SIZE</span>,<span class="mxinfo " id="T3:U90">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">        <span class="mxinfo " id="T19:U91"><span class="var type1" id="S31T19U145">v</span> = <span class="mxinfo " id="T19:U93">zeros(<span class="var type1" id="S15T3U148">MAX_SIZE</span>,<span class="mxinfo " id="T3:U95">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">        <span class="mxinfo " id="T3:U96"><span class="mxinfo " id="T3:U97"><span class="var type1" id="S29T19U153">u</span>(<span class="var type1" id="S24T3U154">index</span>,<span class="mxinfo " id="T20:U100">1</span>)</span> = <span class="mxinfo " id="T3:U101">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">        <span class="mxinfo " id="T21:U102"><span class="mxinfo " id="T21:U103"><span class="var type1" id="S29T19U160">u</span>(<span class="mxinfo " id="T22:U105">:</span>,<span class="mxinfo " id="T20:U106">2</span>)</span> = <span class="mxinfo " id="T16:U107"><span class="var type1" id="S27T16U164">Ks</span> - <span class="var type1" id="S28T16U165">Ks_old</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">        <span class="mxinfo " id="T3:U110"><span class="mxinfo " id="T3:U111"><span class="var type1" id="S29T19U169">u</span>(<span class="var type1" id="S24T3U170">index</span>,<span class="mxinfo " id="T20:U114">2</span>)</span> = <span class="mxinfo " id="T3:U115"><span class="mxinfo " id="T3:U116"><span class="var type1" id="S29T19U174">u</span>(<span class="var type1" id="S24T3U175">index</span>,<span class="mxinfo " id="T20:U119">2</span>)</span>/<span class="mxinfo " id="T3:U120">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">        <span class="mxinfo " id="T21:U121"><span class="mxinfo " id="T21:U122"><span class="var type1" id="S31T19U181">v</span>(<span class="mxinfo " id="T22:U124">:</span>,<span class="mxinfo " id="T20:U125">1</span>)</span> = <span class="mxinfo " id="T21:U126"><span class="var type1" id="S29T19U185">u</span>(<span class="mxinfo " id="T22:U128">:</span>,<span class="mxinfo " id="T20:U129">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">        <span class="mxinfo " id="T21:U130"><span class="mxinfo " id="T21:U131"><span class="var type1" id="S31T19U191">v</span>(<span class="mxinfo " id="T22:U133">:</span>,<span class="mxinfo " id="T20:U134">2</span>)</span> = <span class="mxinfo " id="T21:U135"><span class="var type1" id="S29T19U195">u</span>(<span class="mxinfo " id="T22:U137">:</span>,<span class="mxinfo " id="T20:U138">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">        <span class="mxinfo " id="T1:U139"><span class="var type1" id="S2T1U200">gram_matrix_update</span> = <span class="mxinfo " id="T7:U141"><span class="fcn" id="F345N5:B202">inverseUpdatePlus</span>(<span class="var type1" id="S11T7U203">gram_matrix</span>,<span class="var type1" id="S29T19U204">u</span>,<span class="var type1" id="S31T19U205">v</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">    <span class="comment">% otherwise we use block matrix property to update the matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">        <span class="mxinfo " id="T16:U145"><span class="var type1" id="S27T16U209">Ks</span> = <span class="mxinfo " id="T17:U147"><span class="mxinfo " id="T10:U148"><span class="fcn" id="F211N7:B10">Kfn</span></span>(<span class="var type1" id="S12T8U212">X</span>,<span class="var type1" id="S8T6U213">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">        <span class="mxinfo " id="T16:U151"><span class="var type1" id="S33T16U216">b</span> = <span class="var type1" id="S27T16U217">Ks</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">        <span class="mxinfo " id="T3:U154"><span class="var type1" id="S34T3U220">c</span> = <span class="mxinfo " id="T3:U156"><span class="var type1" id="S17T3U223">F</span>^2+<span class="var type1" id="S21T3U225">keps</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">        <span class="mxinfo " id="T1:U159"><span class="var type1" id="S2T1U228">gram_matrix_update</span> = <span class="mxinfo " id="T1:U161"><span class="fcn" id="F432N4:B230">inverseUpdate</span>(<span class="var type1" id="S11T7U231">gram_matrix</span>,<span class="var type1" id="S33T16U232">b</span>,<span class="var type1" id="S34T3U233">c</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line">        <span class="mxinfo " id="T4:U165"><span class="var type1" id="S5T4U236">X_update</span> = <span class="mxinfo " id="T4:U167">[<span class="var type1" id="S12T8U239">X</span>,<span class="var type1" id="S8T6U240">x</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line">        <span class="mxinfo " id="T5:U170"><span class="var type1" id="S6T5U243">Y_update</span> = <span class="mxinfo " id="T5:U172">[<span class="var type1" id="S13T9U246">Y</span>;<span class="var type1" id="S9T2U248">y</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line">        <span class="mxinfo " id="T1:U175"><span class="var type1" id="S7T1U251">K_update</span> = <span class="mxinfo " id="T1:U177">[<span class="mxinfo " id="T23:U178"><span class="var type1" id="S14T7U254">K</span>,<span class="var type1" id="S27T16U255">Ks</span></span>;<span class="mxinfo " id="T24:U181"><span class="mxinfo " id="T14:U182"><span class="var type1" id="S27T16U258">Ks</span>'</span>,<span class="mxinfo " id="T3:U184"><span class="var type1" id="S17T3U260">F</span>^2</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line">    <span class="mxinfo " id="T17:U186"><span class="var type1" id="S36T17U264">Ks_star</span> = <span class="mxinfo " id="T17:U188"><span class="mxinfo " id="T10:U189"><span class="fcn" id="F211N7:B10">Kfn</span></span>(<span class="var type1" id="S5T4U267">X_update</span>,<span class="var type1" id="S10T6U268">x_star</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line">    <span class="mxinfo " id="T2:U192"><span class="var type1" id="S3T2U271">y_star</span> = <span class="mxinfo " id="T2:U194"><span class="mxinfo " id="T24:U195"><span class="mxinfo " id="T24:U196"><span class="var type1" id="S36T17U275">Ks_star</span>'</span>*<span class="var type1" id="S2T1U276">gram_matrix_update</span></span>*<span class="var type1" id="S6T5U277">Y_update</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line">    <span class="mxinfo " id="T3:U200"><span class="var type1" id="S4T3U280">cov_star</span> = <span class="mxinfo " id="T3:U202"><span class="mxinfo " id="T3:U203">1</span> - <span class="mxinfo " id="T3:U204"><span class="mxinfo " id="T24:U205"><span class="mxinfo " id="T24:U206"><span class="var type1" id="S36T17U286">Ks_star</span>'</span>*<span class="var type1" id="S2T1U287">gram_matrix_update</span></span>*<span class="var type1" id="S36T17U288">Ks_star</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line"></span></span>
</pre>
</body>
</html>
